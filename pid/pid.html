<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PID</title>
</head>
<body>
<script>
    class PIDController {
        constructor(kP, kI, kD) {
            this.kP = kP;
            this.kI = kI;
            this.kD = kD;
            this.errorSum = 0;
            this.lastError = 0;
        }

        update(error) {
            this.errorSum += error;
            const derivative = error - this.lastError;
            this.lastError = error;
            return this.kP * error + this.kI * this.errorSum + this.kD * derivative;
        }
    }

    // Example usage:
    const pid = new PIDController(1, 0.5, 0.1);

    for (let i = 0; i < 100; i++) {
        const controlOutput = pid.update(i - 50);
        // console.log(controlOutput);
    }

</script>

<script>
    let temperature = 0;
    function rnd_Temperature(x,y)
    {
        return Math.random() * ( y - x + 1 ) + x;
    }
    function readTemperatureFromSensor()
    {
        return rnd_Temperature( 60, 80 );
    }
    class TemperatureController {
        constructor(kP, kI, kD) {
            this.pid = new PIDController(kP, kI, kD);
            this.currentTemperature = 0;
            this.targetTemperature = 0;
        }

        setTargetTemperature(temperature) {
            this.targetTemperature = temperature;
        }

        updateTemperature(temperature) {
            this.currentTemperature = temperature;
            const error = this.targetTemperature - this.currentTemperature;
            const controlOutput = this.pid.update(error);
            this.adjustHeater(controlOutput);
        }

        adjustHeater(controlOutput) {
            console.log( 'temperature', temperature, 'adjust', controlOutput,  'adjusted', temperature - controlOutput );

            // Use the control output to adjust the heater power
            // For example, you could use a PWM signal to control the power of an electric heater
        }
    }

    // Example usage:
    const tempController = new TemperatureController(1, 0.5, 0.1);
    tempController.setTargetTemperature(70);

    setInterval(() => {
        // Read the current temperature from a sensor and update the controller
        temperature = readTemperatureFromSensor();
        tempController.updateTemperature(temperature);
    }, 1000); // update every second

</script>
</body>
</html>