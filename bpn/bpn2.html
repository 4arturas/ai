<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
</head>
<body>

<script type="text/javascript">
    function _rnd_Real( x, y )
    {
        return Math.random() * ( y - x ) + x;
    }
    function _rnd_Int( x, y )
    {
        return Math.floor(
                Math.random() * ( y - x + 1 ) + x
        );
    }
    function _log( l )
    {
        console.log( l );
    }
    function _max( a, b )
    {
        return a > b ? a : b;
    }
    function _min( a, b )
    {
        return a < b ? a : b;
    }
</script>

<style type="text/css">
    #bpnTable { border: 1px solid black; margin: 50px 0 0 300px; font-size: 12px; }
    #bpnTable td { border: 1px solid black; width: 80px; height: 30px; padding: 5px; vertical-align: top; }
</style>
<div id='bpnNetError'></div>
<table id='bpnTable'></table>

<script type="text/javascript">

    var bpnTable = document.getElementById('bpnTable');
    var BPN_HI = 1.0;
    var BPN_LO = 0.0;
    var BPN_BIAS = 1.0;

    var BPN_INP = 2;
    var BPN_HID = 2;
    var BPN_OUT = 1;
    var bpnLayer = [ BPN_INP, BPN_HID, 3, BPN_OUT ];
    var bpnColor = ['255,200,200','200,255,200','200,200,255'];
    var BPN_MAX = 5;
    var bpnWeight;
    var bpnVal, bpnErr;

    function bpn_TableCreate()
    {
        var y, x, z;
        var w;
        var max = -1;
        var tr, td;
        for ( x = 0; x < bpnVal.length; x++ )
            max = _max( max, bpnVal[x].length );

        for ( y = 0; y < max; y++ )
        {
            tr = document.createElement('tr');
            tr.setAttribute( 'id', 'tr'+y );
            bpnTable.appendChild( tr );
        } // end for x

        for ( x = 0; x < bpnVal.length; x++ )
        {
            for ( y = 0; y < max; y++ )
            {
                td = document.createElement('td');
                td.style.backgroundColor = 'rgb(' + bpnColor[x] + ')';
                td.setAttribute( 'id', 'td'+y+x);
                td.innerHTML = y + ' ' + x;
                tr = document.getElementById('tr'+y);
                tr.appendChild( td );
            } // end for y
        } // end for x

    }

    function bpn_TableFill()
    {
        var y, x, z;
        var s, w;
        var td;
        for ( x = 0; x < bpnLayer.length; x++ )
        {
            for ( y = 0; y <= bpnLayer[x]; y++ )
            {
                td = document.getElementById('td'+y+x);
                s = bpnVal[x][y] + '';
                s = (s.length>6) ? s.substr(0,6) : s;
                td.innerHTML = 'val='+s;
                s = bpnErr[x][y] + '';
                s = (s.length>6) ? s.substr(0,6) : s;
                td.innerHTML += '<br>err='+s;

                s = '';
                for ( z = 0; z < BPN_MAX; z++ )
                {
                    w = (bpnWeight[x][y][z] + '').substr( 0, 6 );
                    s += '[' + w + ']';
                } // end for z
                td.innerHTML += '<br>' + s;

            } // end for y
        } // end for x
    }

    function bpn_Create()
    {
        var y, x, z;
        var w;
        bpnVal = new Array( bpnLayer.length );
        bpnErr = new Array( bpnLayer.length );
        for ( x = 0; x < bpnLayer.length; x++ )
        {
            bpnVal[x] = new Array( bpnLayer[x]+1 );
            bpnErr[x] = new Array( bpnLayer[x]+1 );
            for ( y = 0; y < bpnLayer[x]+1; y++ )
            {
                bpnVal[x][y] = 0;
                bpnErr[x][y] = 0;
            } // end for y
            bpnVal[x][0] = BPN_BIAS;
        } // end for x

        bpnWeight = new Array( bpnLayer.length );
        for ( x = 0; x < bpnLayer.length; x++ )
        {
            bpnWeight[x] = new Array( BPN_MAX );
            for ( y = 0; y < BPN_MAX; y++ )
            {
                bpnWeight[x][y] = new Array( BPN_MAX );
                for ( z = 0; z < BPN_MAX; z++ )
                {
                    w = _rnd_Real( -0.5, +0.5 );
                    bpnWeight[x][y][z] = w;
                } // end for z
            } // end for y
        } // end for x
    }

    var bpnTrainInp = [
        [1,0],
        [0,1]
    ];
    var bpnTrainOut = [
        [0],
        [1]
    ];

    function bpn_SetInput( Inp )
    {
        var y;
        for ( y = 1; y <= bpnLayer[0]; y++ )
            bpnVal[0][y] = Inp[y-1];
    }

    function bpn_Propagate()
    {
        var y, x, z;
        var Sum;
        for ( x = 1; x < bpnLayer.length; x++ )
        {
            for ( y = 1; y <= bpnLayer[x]; y++ )
            {
                Sum = 0;
                for ( z = 0; z <= bpnLayer[x-1]; z++ )
                    Sum += bpnWeight[x][y][z] * bpnVal[x-1][z];
                bpnVal[x][y] = 1.0 / ( 1.0 + Math.exp( -Sum ) );

            } // end for y
        } // end for x
    }

    function bpn_ComputeOutputError( Target )
    {
        var y;
        var Out, Err;
        var bpnNetError = 0.0;
        for ( y = 1; y <= BPN_OUT; y++ )
        {
            Out = bpnVal[bpnLayer.length-1][y];
            Err = Target[y-1] - Out;
            bpnErr[bpnLayer.length-1][y] = Err * Out * ( 1.0 - Out );
            bpnNetError += 0.5 * ( Err*Err );
        }
        document.getElementById('bpnNetError').innerHTML = 'bpnNetError='+bpnNetError;
        return bpnNetError;
    }

    function bpn_Backpropagate()
    {
        var y, x, z;
        var Out, Err;
        for ( x = bpnLayer.length-1; x >= 1; x-- )
        {
            for ( y = 1; y <= bpnLayer[x-1]; y++ )
            {
                Out= bpnVal[x-1][y];
                Err = 0;
                for ( z = 1; z <= bpnLayer[x]; z++ )
                    Err += bpnWeight[x][z][y] * bpnErr[x][z];
                bpnErr[x-1][y] = Err * Out * ( 1.0 - Out );
            } // end for y
        } // end for x
    }

    function bpn_AdjustWeights()
    {
        var y, x, z;
        var Out, Err;
        for ( x = 1; x < bpnLayer.length; x++ )
        {
            for ( y = 1; y <= bpnLayer[x]; y++ )
            {
                Err = bpnErr[x][y];
                for ( z = 0; z <= bpnLayer[x-1]; z++ )
                {
                    Out = bpnVal[x-1][z];
                    bpnWeight[x][y][z] += 0.5 * Err * Out;
                } // end for z
            } // end for y
        } // end for x
    }

    function bpn_Train( e )
    {
        var n;
        if ( e == 10000 ) return;

        for ( n = 0; n < bpnTrainInp.length; n++ )
        {
            bpn_SetInput( bpnTrainInp[n] );
            bpn_Propagate();
            bpn_ComputeOutputError( bpnTrainOut[n] );
            bpn_Backpropagate();
            bpn_AdjustWeights();
        } // end for n

        bpn_TableFill();
        setTimeout( function() { bpn_Train( (e+1) ); }, 10 );
    }

    function bpn_Main()
    {
        bpn_Create();
        bpn_TableCreate();

        bpn_Train( 0 );

    }
    bpn_Main();

</script>

</body>
</html>